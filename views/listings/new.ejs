<%- layout("./layouts/boilerplate.ejs") %>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<body>
    <div class="container mt-5">
        <h1 class="text-center mb-4">Create Your Listing</h1>
        <form method="POST" action="/listings" class="p-4 border rounded shadow bg-white" style="background: #f8f9fa;">
            
            <!-- Title Field -->
            <div class="mb-3">
                <label for="title" class="form-label">Job Title</label>
                <input type="text" class="form-control" id="title" placeholder="Enter job title" name="listings[title]" required autocomplete="off">
            </div>

            <!-- Company Name Field -->
            <div class="mb-3 position-relative">
                <label for="company" class="form-label">Company Name</label>
                <input type="hidden" id="logo" name="listings[logo]">
                <input type="text" class="form-control" id="company" placeholder="Enter company name" name="listings[company]" required autocomplete="off">
                <div id="suggestions" class="list-group position-absolute" style="z-index: 1000;"></div>
            </div>

            <!-- Description Field -->
            <div class="mb-3">
                <label for="description" class="form-label">Description</label>
                <textarea class="form-control" id="description" placeholder="Enter description" name="listings[description]" rows="4" required></textarea>
            </div>

            <!-- Requirements Field -->
            <div class="mb-3">
                <label for="requirements" class="form-label">Requirements</label>
                <textarea class="form-control" id="requirements" placeholder="Enter requirements" name="listings[requirements]" rows="4"></textarea>
            </div>

            <!-- Salary Field -->
            <div class="mb-3">
                <label for="salary" class="form-label">Salary</label>
                <input type="text" class="form-control" id="salary" placeholder="Ex: 3LPA-5LPA" name="listings[salary]" required>
            </div>

            <!-- Eligibility Category Field -->
            <div class="mb-3">
                <label for="eligibility" class="form-label">Eligibility Category</label>
                <div class="dropdown">
                    <button class="btn btn-outline-secondary dropdown-toggle w-100" type="button" id="eligibilityDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        Select Eligibility
                    </button>
                    <ul class="dropdown-menu p-3" style="max-height: 200px; overflow-y: auto;" aria-labelledby="eligibilityDropdown">
                        <li><input type="checkbox" name="listings[eligibility][]" value="B.E" id="be"> <label for="be">B.E</label></li>
                        <li><input type="checkbox" name="listings[eligibility][]" value="B.Tech" id="btech"> <label for="btech">B.Tech</label></li>
                        <li><input type="checkbox" name="listings[eligibility][]" value="M.E" id="me"> <label for="me">M.E</label></li>
                        <li><input type="checkbox" name="listings[eligibility][]" value="M.Tech" id="mtech"> <label for="mtech">M.Tech</label></li>
                        <li><input type="checkbox" name="listings[eligibility][]" value="Diploma" id="diploma"> <label for="diploma">Diploma</label></li>
                        <li><input type="checkbox" name="listings[eligibility][]" value="B.Sc" id="bsc"> <label for="bsc">B.Sc</label></li>
                        <li><input type="checkbox" name="listings[eligibility][]" value="M.Sc" id="msc"> <label for="msc">M.Sc</label></li>
                        <li><input type="checkbox" name="listings[eligibility][]" value="Ph.D" id="phd"> <label for="phd">Ph.D</label></li>
                    </ul>
                </div>
            </div>

            <!-- Date Field -->
            <div class="mb-3">
                <label for="date" class="form-label">Application Deadline</label>
                <input type="date" class="form-control" id="date" name="listings[created_at]" required>
            </div>

            <!-- Submit Button -->
            <div class="d-grid">
                <button type="submit" class="btn btn-primary">Post</button>
            </div>
        </form>
    </div>

    <script>
        // Event listener on the company input field for autocomplete suggestions
        document.getElementById('company').addEventListener('input', function () {
            const query = this.value.trim();
            if (query.length < 2) {
                document.getElementById('suggestions').innerHTML = '';
                return;
            }
    
            // Fetching company suggestions using Clearbit API
            fetch(`https://autocomplete.clearbit.com/v1/companies/suggest?query=${query}`)
                .then(response => response.json())
                .then(data => {
                    const suggestions = data.map(company => `
                        <button type="button" class="list-group-item list-group-item-action d-flex align-items-center" 
                                onclick="selectCompany('${company.name}', '${company.logo}')">
                            <img src="${company.logo}" alt="${company.name} logo" class="me-2" 
                                 style="width: 30px; height: 30px; border-radius: 50%;">
                            <span>${company.name}</span>
                        </button>
                    `).join('');
                    document.getElementById('suggestions').innerHTML = suggestions;
                })
                .catch(err => console.error('Error fetching companies:', err));
        });

        // Function to select a company from the suggestions
        function selectCompany(company, logo) {
            document.getElementById('company').value = company;
            document.getElementById('logo').value = logo;
            document.getElementById('suggestions').innerHTML = '';
        }
    </script>
</body>
