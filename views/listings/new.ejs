<%- layout("./layouts/boilerplate.ejs") %>

<body>
    <div class="container mt-5">
        <h1 class="text-center mb-4">Create Your Listing</h1>
        <form method="POST" action="/listings" class="p-4 border rounded shadow bg-white" style="background: #f8f9fa;">
            <div class="mb-3">
                <label for="title" class="form-label">Title</label>
                <input type="text" class="form-control" id="title" placeholder="Enter company name" name="listings[title]" required autocomplete="off">
                <div id="suggestions" class="list-group position-absolute"></div>
            </div>
            <div class="mb-3">
                <label for="description" class="form-label">Description</label>
                <textarea class="form-control" id="description" placeholder="Enter description" name="listings[description]" rows="4" required></textarea>
            </div>
            <div class="mb-3">
                <label for="requirements" class="form-label">Requirements</label>
                <textarea class="form-control" id="requirements" placeholder="Enter requirements" name="listings[requirements]" rows="4"></textarea>
            </div>
            <div class="mb-3">
                <label for="salary" class="form-label">Salary</label>
                <input type="number" class="form-control" id="salary" placeholder="Enter salary" name="listings[salary]" min="0" required>
            </div>
            <div class="mb-3">
                <label for="date" class="form-label">Date</label>
                <input type="date" class="form-control" id="date" name="listings[created_at]" required>
            </div>
            <div class="d-grid">
                <button type="submit" class="btn btn-primary">Post</button>
            </div>
        </form>
    </div>

    <script>
        document.getElementById('title').addEventListener('input', function () {
        const query = this.value.trim();
        if (query.length < 2) {
            document.getElementById('suggestions').innerHTML = '';
            return;
        }

        fetch(`https://autocomplete.clearbit.com/v1/companies/suggest?query=${query}`)
            .then(response => response.json())
            .then(data => {
                const suggestions = data.map(company => `
                    <button type="button" class="list-group-item list-group-item-action" onclick="selectCompany('${company.name}')">
                        ${company.name}
                    </button>
                `).join('');
                document.getElementById('suggestions').innerHTML = suggestions;
            })
            .catch(err => console.error('Error fetching companies:', err));
    });

    function selectCompany(company) {
        document.getElementById('title').value = company;
        document.getElementById('suggestions').innerHTML = '';
    }

    </script>
</body>
